<div class="row" style="margin-top: 2%; margin-left: 0; margin-right: 4%;">
    <div class="col-md-6">
        <h1 style="margin-bottom: 5%;">
            Tracking Vehicles
        </h1>
    </div>
    <div class="col-md-6">
        <div ng-app ng-controller="Ctrl" style="text-align: right; margin-top: 10px;">
            <b style="margin-bottom: 0px;">
                {{date | date:'dd.MM.yyyy'}}
            </b>
        </div>
        <div style="text-align: right;">
            {{date | date:'EEEE'}}
        </div>

    </div>

</div>
<i data-toggle="modal" data-target="#vehicleLastLocationModal" id="vehicleLastLocationModalopen"></i>
<i data-toggle="modal" data-target="#vehicleLocationModal" id="vehicleLocationModalopen"></i>
<!-- <a routerLink="add" class="btn btn-sm btn-success mb-2">Add User</a> -->
<div class="row">
    <div class="col-md-6">

    </div>

    <div class="col-md-6">
        <div class="row">
            <div class="col-md-6" style="text-align: center;">
                From
            </div>
            <div class="col-md-6" style="left: 5px;">
                To
            </div>
        </div>

    </div>
</div>


<div class="row" style = "margin-right: 4%;margin-left: 0;">
    <div class="col-md-6">


        <form class="form-inline">

            <i class="fas fa-search" aria-hidden="true"></i>
            <input class="form-control form-control-sm ml-3 w-75" type="text" placeholder="Search Vehicle"
                aria-label="Search" name="search" [(ngModel)]="searchText" autocomplete="off"
                style="background-color: #d9d9d9; ">
        </form>
    </div>



    <div class="col-md-6">
        <form class="form-inline" [formGroup]="form" (ngSubmit)="onSubmit()" style="float: right;">

            <input type="date" class="form-control" [ngModel]="startDate | date:'yyyy-MM-dd'" max="{{startDate}}"
                formControlName="startDate" style="padding: 0px 10px; margin-right: 15px;">
            <input type="date" class="form-control" [ngModel]="endDate | date:'yyyy-MM-dd'" min="{{endDate}}"
                formControlName="endDate" placeholder="Tosasasasas" style="padding: 0px 10px; margin-right: 10px;">
            <button class="btn btn-success" type="button" type="submit"
                style="background-color:  #3385ff; padding: 2px 5px; float: right;">GO!</button>

        </form>
    </div>
</div>
<div class="row">

</div>
<div class="tableFixHead" style="margin-top: 10px;margin-right: 5%;margin-left: 10px;" >
    <table class="table table-striped table-bordered table-hover">
        <thead class="thead-dark">
            <tr>
                <th style="vertical-align: top;">#</th>
                <th style="vertical-align: top;">Vehicle No. </th>
                <th style="vertical-align: top;">Pin No.</th>
                <th style="vertical-align: top;">Engine No.</th>
                <th style="vertical-align: top;">Engine Hours</th>
                <th style="vertical-align: top;">Latest Time</th>
                <th style="vertical-align: top;">Summary</th>
                <th style="vertical-align: top;"> <i class="fas fa-route fa-3x"></i> </th>
                <th style="vertical-align: top;">Vehicle Map</th>
                <th style="vertical-align: top;">Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- <tr *ngFor="let v of variant"> -->
            <tr *ngFor="let t of trackdocs | filter:searchText | paginate : {itemsPerPage : 20, currentPage : p} let i = index"
                (click)="setClickedRow(i)" [class.active]="i == selectedRow">
                <td>{{i+1}}</td>
                <td> {{t.vehicleNumber}}</td>
                <td id="t1"> <a id="onNavigate" (click)="onNavigate(t.pinno)" style="color: inherit;">{{t.pinno}}</a></td>
                <td>{{t.engineNumber}}</td>
                <td>{{t.totalEngineHours}}</td>
                <td>{{t.lastDataReceivedAt | date:'dd-MM-yyyy'}}</td>
                <td> <a>
                        View
                    </a> </td>
                <td> {{t.distance | number :'1.2-2'}}</td>
                <td>
                    <div style="margin-left: 20px; padding: 1px 5px;" class="btn btn-primary"
                        (click)="mapDate(t.pinno)">Map</div>
                </td>
                <td>
                    <ul class="actions">
                        <a>
                            <li class="actions-item"><i class="fa fa-share-square"></i></li>
                        </a>
                        <a>
                            <li class="actions-item"><i class="fa fa-clock-o"></i></li>
                        </a>
                        <a>
                            <li class="actions-item"><i class="fa fa-map-marker"
                                    (click)="trackVehicleLastLocation(t.pinno)"></i></li>
                        </a>
                        <a>
                            <li class="actions-item"><i class="fa fa-ellipsis-v "></i></li>
                        </a>

                    </ul>
                </td>
            </tr>
            <tr *ngIf="!track">
                <td colspan="4" class="text-center">
                    <span class="spinner-border spinner-border-lg align-center"></span>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="input-group-icon input-group-icon-right mr-3 col-md-12" style="margin-left: 50%;">
    <pagination-controls (pageChange)="p = $event"></pagination-controls>
</div>



<div class="modal fade" id="vehicleLocationModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Vehicle Path Map</h5>
                <button type="button" class="close" id="vehicleLocationModalclose" data-dismiss="modal"
                    aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- animation="BOUNCE" -->
                <agm-map [latitude]='maplat' [longitude]='maplng' [zoom]='18' [fullscreenControl]='true'
                    [mapTypeControl]='true' [streetViewControl]="true">
                    

                    <agm-marker *ngFor='let marker of coordinatedata'
                        [iconUrl]="{url: markerPath, scaledSize: {height: 25,width: 15}}" [latitude]='marker.lat'
                        [longitude]='marker.lng' [opacity]='opacity' [markerDraggable]='true' [agmFitBounds]="true">
                        <agm-info-window>
                            <strong>Date : {{marker.time | date:'dd-MM-yyyy'}}</strong>
                            <br>
                            <strong>Time : {{marker.time | date:'h:mm:ss a':'+0000'}}</strong>
                        </agm-info-window>
                    </agm-marker>
                    <agm-polyline [visible]="true" [strokeWeight]="2" [strokeColor]="'#57eaff'">
                        <agm-polyline-point *ngFor="let coordinate of coordinatedata; let i=index"
                            [latitude]="coordinate.lat" [longitude]="coordinate.lng">
                        </agm-polyline-point>
                    </agm-polyline>

                    <agm-marker *ngFor="let coordinate of start_marker; let i=index" animation="BOUNCE"
                        [iconUrl]="{url: imageStartMark, scaledSize: {height: 50,width: 34}}"
                        [latitude]="coordinate.lat" [longitude]="coordinate.lng" [agmFitBounds]="true">
                        <agm-info-window>
                            <strong>Date : {{coordinate.time | date:'dd-MM-yyyy'}}</strong>
                            <br>
                            <strong>Time : {{coordinate.time | date:'h:mm:ss a':'+0000'}}</strong>
                        </agm-info-window>
                    </agm-marker>

                    <agm-marker *ngFor="let coordinate of end_marker; let i=index" animation="BOUNCE"
                        [iconUrl]="{url: startMarker, scaledSize: {height: 50,width: 33}}"
                        [latitude]="coordinate.lat" [longitude]="coordinate.lng" [agmFitBounds]="true">
                        <agm-info-window>
                            <strong>Date : {{coordinate.time | date:'dd-MM-yyyy'}}</strong>
                            <br>
                            <strong>Time : {{coordinate.time | date:'h:mm:ss a':'+0000'}}</strong>
                        </agm-info-window>
                    </agm-marker>
                </agm-map>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Last Location -->
<div class="modal fade" id="vehicleLastLocationModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Vehicle Last Location</h5>
                <button type="button" class="close" id="vehicleLastLocationModalClose" data-dismiss="modal"
                    aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <agm-map [latitude]='lastLocationlat' [longitude]='lastLocationlng' [zoom]='8'
                    [fullscreenControl]='true' [mapTypeControl]='true' [streetViewControl]="false">
                    <agm-marker [latitude]='lastLocationlat' [longitude]='lastLocationlng' [opacity]='opacity'
                        [markerDraggable]='false' [agmFitBounds]="true">
                        <agm-info-window>
                            <strong>lat : {{lastLocationlat}}</strong>
                            <br>
                            <strong>lng : {{lastLocationlng}}</strong>
                        </agm-info-window>
                    </agm-marker>
                </agm-map>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>